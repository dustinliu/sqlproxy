plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.3.41'
    id 'application'
    id "com.google.protobuf" version "0.8.10"
    id 'groovy'
}

repositories {
    jcenter()
    mavenCentral()
}

def grpcVersion = '1.26.0'
def protobufVersion = '3.11.1'
def protocVersion = protobufVersion
dependencies {
    implementation platform('org.jetbrains.kotlin:kotlin-bom')
    implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'
    implementation 'org.jetbrains.kotlin:kotlin-reflect'
    implementation 'org.apache.commons:commons-lang3:3.9'
    implementation "com.google.protobuf:protobuf-java:${protobufVersion}"
    implementation "io.grpc:grpc-protobuf:${grpcVersion}"
    implementation "io.grpc:grpc-stub:${grpcVersion}"
    implementation "javax.annotation:javax.annotation-api:1.3.2"
    implementation 'org.slf4j:slf4j-api:1.7.29'
    implementation 'com.zaxxer:HikariCP:3.4.1'
    runtimeOnly 'ch.qos.logback:logback-core:1.2.3'
    runtimeOnly 'ch.qos.logback:logback-classic:1.2.3'
    runtimeOnly "io.grpc:grpc-netty:${grpcVersion}"
//    testImplementation 'org.jetbrains.kotlin:kotlin-test'
//    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'
    testImplementation 'org.spockframework:spock-core:1.3-groovy-2.5'
    testImplementation 'org.codehaus.groovy:groovy-all:2.5.6'
    testRuntime "net.bytebuddy:byte-buddy:1.10.6"
    testRuntime "org.objenesis:objenesis:2.6"
}

application {
    mainClassName = 'ysqlrelay.AppKt'
}

sourceSets {
    main {
        java {
            srcDirs 'build/generated/source/proto/main/grpc'
            srcDir 'build/generated/source/proto/main/java'
        }
    }
}

protobuf {
    protoc { artifact = "com.google.protobuf:protoc:${protocVersion}" }
    plugins {
        grpc { artifact = "io.grpc:protoc-gen-grpc-java:${grpcVersion}" }
    }
    generateProtoTasks {
        all()*.plugins { grpc {} }
    }
}
